module.exports = function () {
  return (req, res, next) => {
    if (!req.app.get('view engine')) throw new Error('View engine not set');
    if (req.app.get('view engine') !== 'ejs') throw new Error('Not using EJS');
    res.flash = function (view, options, variables) {
      let flash = {};
      if (options.type) { flash.type = options.type } else { throw new Error('Please specify a flash type'); }
      if (options.message) { flash.message = options.message } else { throw new Error('Please specify a flash message'); }
      if (options.title) flash.title = options.title;
      if (options.class) flash.class = options.class;
      if (options.id) flash.id = options.id;
      let responseVariables = {};
      responseVariables.flash = flash;
      Object.keys(variables).forEach(function (key) {
        responseVariables[key] = variables[key];
      });
      res.render(view, responseVariables);
    };
    next();
  }
}
